define(["@grafana/data","react","@grafana/ui","lodash","@grafana/runtime"],((e,t,r,n,o)=>(()=>{var a={8796:(e,t,r)=>{var n=r(1832).Symbol;e.exports=n},4148:e=>{e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},128:(e,t,r)=>{var n=r(4684),o=r(976),a=r(9612),i=r(1728),s=r(7532),c=r(7168),u=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=a(e),l=!r&&o(e),p=!r&&!l&&i(e),f=!r&&!l&&!p&&c(e),h=r||l||p||f,y=h?n(e.length,String):[],b=y.length;for(var d in e)!t&&!u.call(e,d)||h&&("length"==d||p&&("offset"==d||"parent"==d)||f&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||s(d,b))||y.push(d);return y}},7480:(e,t,r)=>{var n=r(8796),o=r(7520),a=r(9488),i=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?o(e):a(e)}},9120:(e,t,r)=>{var n=r(7480),o=r(7256);e.exports=function(e){return o(e)&&"[object Arguments]"==n(e)}},8048:(e,t,r)=>{var n=r(3024),o=r(5632),a=r(2016),i=r(1008),s=/^\[object .+?Constructor\]$/,c=Function.prototype,u=Object.prototype,l=c.toString,p=u.hasOwnProperty,f=RegExp("^"+l.call(p).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||o(e))&&(n(e)?f:s).test(i(e))}},1864:(e,t,r)=>{var n=r(7480),o=r(4692),a=r(7256),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&o(e.length)&&!!i[n(e)]}},2300:(e,t,r)=>{var n=r(2016),o=r(7944),a=r(3156),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return a(e);var t=o(e),r=[];for(var s in e)("constructor"!=s||!t&&i.call(e,s))&&r.push(s);return r}},1020:(e,t,r)=>{var n=r(1532),o=r(7608),a=r(4224);e.exports=function(e,t){return a(o(e,t,n),e+"")}},9804:(e,t,r)=>{var n=r(3688),o=r(3804),a=r(1532),i=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:a;e.exports=i},4684:e=>{e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},4784:e=>{e.exports=function(e){return function(t){return e(t)}}},9240:(e,t,r)=>{var n=r(1832)["__core-js_shared__"];e.exports=n},3804:(e,t,r)=>{var n=r(8472),o=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},5448:(e,t,r)=>{var n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=n},8472:(e,t,r)=>{var n=r(8048),o=r(1456);e.exports=function(e,t){var r=o(e,t);return n(r)?r:void 0}},7520:(e,t,r)=>{var n=r(8796),o=Object.prototype,a=o.hasOwnProperty,i=o.toString,s=n?n.toStringTag:void 0;e.exports=function(e){var t=a.call(e,s),r=e[s];try{e[s]=void 0;var n=!0}catch(e){}var o=i.call(e);return n&&(t?e[s]=r:delete e[s]),o}},1456:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},7532:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,r){var n=typeof e;return!!(r=null==r?9007199254740991:r)&&("number"==n||"symbol"!=n&&t.test(e))&&e>-1&&e%1==0&&e<r}},6655:(e,t,r)=>{var n=r(240),o=r(9032),a=r(7532),i=r(2016);e.exports=function(e,t,r){if(!i(r))return!1;var s=typeof t;return!!("number"==s?o(r)&&a(t,r.length):"string"==s&&t in r)&&n(r[t],e)}},5632:(e,t,r)=>{var n,o=r(9240),a=(n=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!a&&a in e}},7944:e=>{var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},3156:e=>{e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},8416:(e,t,r)=>{e=r.nmd(e);var n=r(5448),o=t&&!t.nodeType&&t,a=o&&e&&!e.nodeType&&e,i=a&&a.exports===o&&n.process,s=function(){try{return a&&a.require&&a.require("util").types||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=s},9488:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},7608:(e,t,r)=>{var n=r(4148),o=Math.max;e.exports=function(e,t,r){return t=o(void 0===t?e.length-1:t,0),function(){for(var a=arguments,i=-1,s=o(a.length-t,0),c=Array(s);++i<s;)c[i]=a[t+i];i=-1;for(var u=Array(t+1);++i<t;)u[i]=a[i];return u[t]=r(c),n(e,this,u)}}},1832:(e,t,r)=>{var n=r(5448),o="object"==typeof self&&self&&self.Object===Object&&self,a=n||o||Function("return this")();e.exports=a},4224:(e,t,r)=>{var n=r(9804),o=r(7875)(n);e.exports=o},7875:e=>{var t=Date.now;e.exports=function(e){var r=0,n=0;return function(){var o=t(),a=16-(o-n);if(n=o,a>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},1008:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},3688:e=>{e.exports=function(e){return function(){return e}}},764:(e,t,r)=>{var n=r(1020),o=r(240),a=r(6655),i=r(68),s=Object.prototype,c=s.hasOwnProperty,u=n((function(e,t){e=Object(e);var r=-1,n=t.length,u=n>2?t[2]:void 0;for(u&&a(t[0],t[1],u)&&(n=1);++r<n;)for(var l=t[r],p=i(l),f=-1,h=p.length;++f<h;){var y=p[f],b=e[y];(void 0===b||o(b,s[y])&&!c.call(e,y))&&(e[y]=l[y])}return e}));e.exports=u},240:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},1532:e=>{e.exports=function(e){return e}},976:(e,t,r)=>{var n=r(9120),o=r(7256),a=Object.prototype,i=a.hasOwnProperty,s=a.propertyIsEnumerable,c=n(function(){return arguments}())?n:function(e){return o(e)&&i.call(e,"callee")&&!s.call(e,"callee")};e.exports=c},9612:e=>{var t=Array.isArray;e.exports=t},9032:(e,t,r)=>{var n=r(3024),o=r(4692);e.exports=function(e){return null!=e&&o(e.length)&&!n(e)}},1728:(e,t,r)=>{e=r.nmd(e);var n=r(1832),o=r(6620),a=t&&!t.nodeType&&t,i=a&&e&&!e.nodeType&&e,s=i&&i.exports===a?n.Buffer:void 0,c=(s?s.isBuffer:void 0)||o;e.exports=c},3024:(e,t,r)=>{var n=r(7480),o=r(2016);e.exports=function(e){if(!o(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},4692:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},2016:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},7256:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},7168:(e,t,r)=>{var n=r(1864),o=r(4784),a=r(8416),i=a&&a.isTypedArray,s=i?o(i):n;e.exports=s},68:(e,t,r)=>{var n=r(128),o=r(2300),a=r(9032);e.exports=function(e){return a(e)?n(e,!0):o(e)}},6620:e=>{e.exports=function(){return!1}},3744:t=>{"use strict";t.exports=e},1622:e=>{"use strict";e.exports=o},4568:e=>{"use strict";e.exports=r},1928:e=>{"use strict";e.exports=n},9010:e=>{"use strict";e.exports=t}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={id:e,loaded:!1,exports:{}};return a[e](r,r.exports,s),r.loaded=!0,r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var c={};return(()=>{"use strict";s.r(c),s.d(c,{plugin:()=>N});var e=s(3744),t=s(9010),r=s.n(t),n=s(4568);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){o(e,t,r[t])}))}return e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var u=s(764),l=s.n(u);function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}e.DataSourceApi;class f{constructor(){p(this,"QueryEditor",void 0)}}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){h(e,t,r[t])}))}return e}function b(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}p(f,"templateUrl","partials/annotations.editor.html");const d=({onChange:e,query:o})=>{const[a,i]=(0,t.useState)(o),s=()=>{e(a,`${a.queryText} (${a.dataPath})`)};return r().createElement(r().Fragment,null,r().createElement("div",{className:"gf-form"},r().createElement("span",{className:"gf-form-label width-10"},"Data Path"),r().createElement("input",{name:"dataPath",className:"gf-form-input",onBlur:s,onChange:e=>i(b(y({},a),{[e.currentTarget.name]:e.currentTarget.value})),value:a.dataPath})),r().createElement("div",{className:"gf-form"},r().createElement("span",{className:"gf-form-label width-10"},"Query"),r().createElement(n.QueryField,{query:a.queryText||"",onBlur:s,onChange:(e,t)=>i(b(y({},a),{queryText:e})),portalOrigin:"graphQL"})))};function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const g={queryText:'query {\n      data:submissions(user:"$user"){\n          Time:submitTime\n          idle running completed\n      }\n  }',dataPath:"data",timePath:"Time",endTimePath:"endTime",timeFormat:null,groupBy:"",aliasBy:"",annotationTitle:"",annotationText:"",annotationTags:"",constant:6.5};class v{setStatus(e){this.status=e}setMessage(e){this.message=e}setError(e){this.error=e}setDetails(e){this.details=e}constructor(e,t,r,n){m(this,"status",void 0),m(this,"message",void 0),m(this,"error",void 0),m(this,"details",void 0),this.status=e||"Failed",this.message=t||"None",this.error=r,this.details=n}}class O{constructor(){m(this,"AnnotationsQueryCtrl",void 0),m(this,"VariableQueryEditor",void 0),this.AnnotationsQueryCtrl=new f,this.VariableQueryEditor=d}}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){j(e,t,r[t])}))}return e}function P(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class x extends t.PureComponent{onComponentDidMount(){}render(){const e=l()(this.props.query,g),{queryText:t,dataPath:o,timePath:a,timeFormat:i,groupBy:s,aliasBy:c}=e;return r().createElement(r().Fragment,null,r().createElement(n.QueryField,{query:t||"",onChange:this.onChangeQuery,portalOrigin:"graphQL"}),r().createElement("div",{className:"gf-form"},r().createElement(n.Tooltip,{content:"dot-delimited path to data in response. Separate with commas to use multiple data paths",placement:"top"},r().createElement(n.InlineFormLabel,{width:8},"Data path")),r().createElement(n.Input,{width:24,value:o||"",onChange:this.onDataPathTextChange})),r().createElement("div",{className:"gf-form"},r().createElement(n.Tooltip,{content:"dot-delimited path to time under data path",placement:"top"},r().createElement(n.InlineFormLabel,{width:8},"Time path")),r().createElement(n.Input,{width:24,value:a||"",onChange:this.onTimePathTextChange})),r().createElement("div",{className:"gf-form"},r().createElement(n.Tooltip,{content:r().createElement("a",{href:"https://momentjs.com/docs/#/parsing/string-format/",title:"Formatting help"},"Optional time format in moment.js format.Â ",r().createElement(n.Icon,{name:"external-link-alt"})),placement:"top"},r().createElement(n.InlineFormLabel,{width:8},"Time format")),r().createElement(n.Input,{width:24,value:i||"",onChange:this.onTimeFormatTextChange})),r().createElement("div",{className:"gf-form"},r().createElement(n.Tooltip,{content:"dot-delimited path for the key to use. Separate with commas to use multiple fields to group by",placement:"top"},r().createElement(n.InlineFormLabel,{width:8},"Group by")),r().createElement(n.Input,{width:24,value:s||"",onChange:this.onGroupByTextChange})),r().createElement("div",{className:"gf-form"},r().createElement(n.Tooltip,{content:"The formattable text to alias by. Use $field_<field name> to replace with the value of a field, or $fieldName to replace with the name of the field",placement:"top"},r().createElement(n.InlineFormLabel,{width:8},"Alias by")),r().createElement(n.Input,{width:24,value:c||"",onChange:this.onAliasByTextChange})))}constructor(...e){super(...e),j(this,"onChangeQuery",((e,t)=>{const{onChange:r,query:n}=this.props;r&&r(P(w({},n),{queryText:e}))})),j(this,"onDataPathTextChange",(e=>{const{onChange:t,query:r}=this.props;t(P(w({},r),{dataPath:e.target.value}))})),j(this,"onTimePathTextChange",(e=>{const{onChange:t,query:r}=this.props;t(P(w({},r),{timePath:e.target.value}))})),j(this,"onTimeFormatTextChange",(e=>{const{onChange:t,query:r}=this.props;t(P(w({},r),{timeFormat:e.target.value}))})),j(this,"onGroupByTextChange",(e=>{const{onChange:t,query:r}=this.props;t(P(w({},r),{groupBy:e.target.value}))})),j(this,"onAliasByTextChange",(e=>{const{onChange:t,query:r}=this.props;t(P(w({},r),{aliasBy:e.target.value}))}))}}var T=s(1928),E=s.n(T);function S(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){S(e,t,r[t])}))}return e}function C(e,t=null,r="."){return Object.keys(e).reduce(((n,o)=>{const a="object"==typeof e[o]&&null!=e[o],i=[t,o].filter(Boolean).join(r);return a?D({},n,C(e[o],i,r)):(s=D({},n),c=null!=(c={[i]:e[o]})?c:{},Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(c)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(c)).forEach((function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(c,e))})),s);var s,c}),{})}function A(t){let r=(0,e.dateTime)(t,e.ISO_8601);if(r.isValid()){let e=r.toISOString();return e===t||e.substring(0,19)===t.substring(0,19)}return!1}var F=s(1622);function q(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function _(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){q(a,n,o,i,s,"next",e)}function s(e){q(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Q(e,t,r[t])}))}return e}const k=["constant","custom","query","textbox"];function B(e,t){let r=e||"";return Object.keys(t).forEach((e=>{const n=t[e];r=r.replace(`\${${e}}`,n.text)})),r}class $ extends e.DataSourceApi{getDataPathArray(e){return e.split(",").map((e=>e.trim()))}request(e){const t={url:this.url,method:"POST",data:{query:e}};return(this.basicAuth||this.withCredentials)&&(t.withCredentials=!0),this.basicAuth&&(t.headers={Authorization:this.basicAuth}),this.backendSrv.datasourceRequest(t)}postQuery(e,t){return console.log(t),this.request(t).then((t=>({query:e,results:t}))).catch((e=>{if(e.data&&e.data.error)throw{message:"GraphQL error: "+e.data.error.reason,error:"GraphQL error: "+e.data.error};throw"GraphQL error: "+e.data.error}))}createQuery(e,t,r=void 0){let n=B(e.queryText,(o=I({},r),a=null!=(a={timeFrom:{text:"from",value:null==t?void 0:t.from.valueOf()},timeTo:{text:"to",value:null==t?void 0:t.to.valueOf()}})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(a,e))})),o));var o,a;return this.postQuery(e,n)}static getDocs(e,t){return[]}getDocs(e,t){if(!e)throw"resultsData was null or undefined";let r=t.split(".").reduce(((e,t)=>e?e[t]:null),e.data);if(!r){const r=e.errors;if(r&&0!==r.length)throw r[0];throw"Your data path did not exist! dataPath: "+t}e.errors&&(console.log("Got GraphQL errors:"),console.log(e.errors));const n=[];let o=e=>{n.push(C(e))};if(Array.isArray(r))for(const e of r)o(e);else o(r);return n}myAnnotationsQuery(t){const r=l()(t.annotation,g);return Promise.all([this.createQuery(r,t.range)]).then((t=>{const n=[];for(const o of t){const{timePath:t,endTimePath:a,timeFormat:i}=o.query,s=$.getDataPathArray(o.query.dataPath);for(const c of s){const s=this.getDocs(o.results.data,c);for(const o of s){const s={};t in o&&(s.time=(0,e.dateTime)(o[t],i).valueOf()),a in o&&(s.isRegion=!0,s.timeEnd=(0,e.dateTime)(o[a],i).valueOf());let c=r.annotationTitle,u=r.annotationText,l=r.annotationTags;for(const e in o){const t=o[e],r=new RegExp("\\$field_"+e,"g");c=c.replace(r,t),u=u.replace(r,t),l=l.replace(r,t)}s.title=c,s.text=u;const p=[];for(const e of l.split(",")){const t=e.trim();t&&p.push(t)}s.tags=p,n.push(s)}}}return n}))}static getDataPathArray(e){const t=[];for(const r of e.split(",")){const e=r.trim();e&&t.push(e)}if(!t)throw"data path is empty!";return t}query(t){var r=this;return _((function*(){return Promise.all(t.targets.map((e=>r.createQuery(l()(e,g),t.range,t.scopedVars)))).then((n=>{const o=[];for(let a of n){const n=r.getDataPathArray(a.query.dataPath),{timePath:i,timeFormat:s,groupBy:c,aliasBy:u}=a.query,l=c.split(","),p=[];for(const e of l){const t=e.trim();t&&p.push(t)}for(const c of n){const n=r.getDocs(a.results.data,c),l=new Map;for(const r of n){i in r&&(r[i]=(0,e.dateTime)(r[i],s));const n=[];for(const e of p)n.push(r[e]);const o=n.toString();let a=l.get(o);if(a)a.fields.values.apply(r);else{let a=new e.MutableDataFrame({fields:[]});const s={};for(const e in r)s["field_"+e]=r[e];for(const c in r){let l,p=e.FieldType.string;if(c===i||A(String(r[c]))?p=e.FieldType.time:E().isNumber(r[c])&&(p=e.FieldType.number),l=0!==n.length?o+"_"+c:c,u){l=u;const e=I({},s);e.fieldName=c;for(const t in e){const r=e[t],n=new RegExp("\\$"+t,"g");l=l.replace(n,r)}l=B(l,t.scopedVars)}a.fields.push({name:c,type:p,config:{displayName:l},values:[r]})}l.set(o,a)}}for(const e of l.values())o.push(e)}}return{data:o}}))}))()}testDatasource(){console.log("here"),alert("Here");let e=new v;return this.postQuery(g,"{__schema{queryType{name}}}").then((t=>t.errors?(e.setError(t.errors),console.log(t.errors),e.setStatus("error"),e.setMessage("GraphQL Error: "+t.errors[0].message),e):(e.setStatus("success"),e.setMessage("Success"),e)),(t=>(console.log(t),e.setError(t),e.setStatus("error"),e.setMessage("HTTP Response "+t.status+": "+t.statusText),e)))}metricFindQuery(e,t){var r=this;return _((function*(){const t=[];let n=(e=l()(e,g)).queryText;n=B(n,I({},r.getVariables));const o=yield r.postQuery(e,n),a=r.getDocs(o.results.data,e.dataPath);for(const e of a)if("__text"in e&&"__value"in e)t.push({text:e.__text,value:e.__value});else for(const r in e)t.push({text:e[r]});return t}))()}getVariables(){const e={};return Object.values((0,F.getTemplateSrv)().getVariables()).forEach((t=>{if(!k.includes(t.type))return void console.warn(`Variable of type "${t.type}" is not supported`);const r=t;let n=r.current.value;("$__all"===n||E().isEqual(n,["$__all"]))&&(n=null===r.allValue||""===r.allValue?r.options.slice(1).map((e=>e.value)):r.allValue),e[r.id]={text:r.current.text,value:n}})),e}constructor(e,t){super(e),Q(this,"backendSrv",void 0),Q(this,"basicAuth",void 0),Q(this,"withCredentials",void 0),Q(this,"url",void 0),Q(this,"uid",void 0),Q(this,"id",void 0),this.backendSrv=t,this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials,this.url=e.url,this.uid=e.uid,this.id=e.id,this.components=new O}}const N=new e.DataSourcePlugin($).setConfigEditor((function(e){const{onOptionsChange:t,options:o}=e,s=e=>{const r=i(a({},o.jsonData),{path:e.target.value});t(i(a({},o),{jsonData:r}))},{jsonData:c,secureJsonFields:u}=o,l=o.secureJsonData||{};return r().createElement("div",{className:"gf-form-group"},r().createElement(n.DataSourceHttpSettings,{defaultUrl:"http://localhost:8888/api",dataSourceConfig:o,onChange:t,showAccessOptions:!0}),r().createElement(n.InlineField,{label:"Options",labelWidth:12},r().createElement(n.Input,{onChange:s,value:"",width:40})),r().createElement(n.InlineField,{label:"Path",labelWidth:12},r().createElement(n.Input,{onChange:s,value:c.path||"",placeholder:"json field returned to frontend",width:40})),r().createElement(n.InlineField,{label:"API Key",labelWidth:12},r().createElement(n.SecretInput,{isConfigured:u&&u.apiKey,value:l.apiKey||"",placeholder:"secure json field (backend only)",width:40,onReset:()=>{t(i(a({},o),{secureJsonFields:i(a({},o.secureJsonFields),{apiKey:!1}),secureJsonData:i(a({},o.secureJsonData),{apiKey:""})}))},onChange:e=>{t(i(a({},o),{secureJsonData:{apiKey:e.target.value}}))}})))})).setQueryEditor(x);console.log(N)})(),c})()));
//# sourceMappingURL=module.js.map